(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{163:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return b}));var a=n(2),r=n(9),o=(n(0),n(174)),i={id:"cloudwallet",title:"Cloud Wallet",sidebar_label:"Cloud Wallet"},l={id:"cloudwallet",isDocsHomePage:!1,title:"Cloud Wallet",description:"Cloud wallet and MoneyStream",source:"@site/docs/cloudwallet.md",permalink:"/moneystream-project/docs/cloudwallet",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/cloudwallet.md",sidebar_label:"Cloud Wallet",sidebar:"someSidebar",previous:{title:"Bitcoin",permalink:"/moneystream-project/docs/bitcoin"},next:{title:"privacy",permalink:"/moneystream-project/docs/privacy"}},c=[{value:"Cloud wallet and MoneyStream",id:"cloud-wallet-and-moneystream",children:[]},{value:"How to sign transactions",id:"how-to-sign-transactions",children:[]}],s={rightToc:c};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"cloud-wallet-and-moneystream"},"Cloud wallet and MoneyStream"),Object(o.b)("p",null,"This document describes how cloud wallets can support the MoneyStream application."),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"MoneyStream uses a cash application protocol. That means transactions are to be signed using SIGHASH_SINGLE|ANYONECANPAY or SIGHASH_NONE. All communications must be exchanged over a secure channel (ssl/tls)."))),Object(o.b)("p",null,"The overall application architecture is shown below."),Object(o.b)("p",null,Object(o.b)("img",Object(a.a)({parentName:"p"},{src:"https://moneystreamdev.github.io/moneystream-project/img/moneystream-cloudwallet.png",alt:"MoneyStream communication with cloud wallet"}))),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"The user must be authenticated to the cloud wallet with an authentication token. The user sends the following request to the cloud wallet api.")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n    id:"requestid_string",\n    action:"sign",\n    amount:satoshis_integer,\n    max:satoshis_integer,\n    timelock:timelock_integer\n}\n')),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"id")," is the requestid. It will be the same for multiple requests. ",Object(o.b)("inlineCode",{parentName:"p"},"amount")," is the requested amount in satoshis. ",Object(o.b)("inlineCode",{parentName:"p"},"max")," is the maximum satoshis to allow in this request. "),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"The cloud wallet returns a signed transaction.")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n    id:"requestid_string",\n    txid:"transactionid_string",\n    hex:"transaction_hex_string"\n}\n')),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"On subsequent requests, the transaction must use the same UTXOs as the first request!"))),Object(o.b)("p",null,"The user must send another request (sign or close) before the timelock. If none is received then the UTXO should be assumed to be spent."),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"The extension will forward the transaction to the web site wallet with additional information that the application needs.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"(Not shown in diagram). User will send a request to close the request."))),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'{\n    id:"requestid_string",\n    action:"close",\n    txid:"txid_string"\n}\n')),Object(o.b)("h2",{id:"how-to-sign-transactions"},"How to sign transactions"),Object(o.b)("p",null,"Transactions must be signed using the timelock value. Adjust funding with change amount as necessary."),Object(o.b)("p",null,"If the ",Object(o.b)("inlineCode",{parentName:"p"},"max")," amount can be accomodated using one UTXO then the transaction will look like this.\n|Index|SigHash                     |Output       |\n|-----|----------------------------|-------------|\n|0    |SIGHASH_SINGLE","|","ANYONECANPAY|Change Amount|"),Object(o.b)("p",null,"If the ",Object(o.b)("inlineCode",{parentName:"p"},"max")," amount requires multiple UTXO then the transaction will look like this.\n|Index|SigHash                     |Output       |\n|-----|----------------------------|-------------|\n|0    |SIGHASH_SINGLE","|","ANYONECANPAY|Change Amount|\n|1    |SIGHASH_NONE|(no output)|"),Object(o.b)("p",null,"If the ",Object(o.b)("inlineCode",{parentName:"p"},"max")," amount is too large then there will be no output. The sum of the input values will be less than or equal to ",Object(o.b)("inlineCode",{parentName:"p"},"amount"),"."),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Index"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"SigHash"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Output"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"0"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"SIGHASH_NONE"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"(no output)")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"1"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"SIGHASH_NONE"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"(no output)")))))}b.isMDXComponent=!0},174:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),b=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=b(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=b(n),p=a,d=u["".concat(i,".").concat(p)]||u[p]||m[p]||o;return n?r.a.createElement(d,l(l({ref:t},s),{},{components:n})):r.a.createElement(d,l({ref:t},s))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);